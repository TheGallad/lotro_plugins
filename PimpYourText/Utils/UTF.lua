------------------------------------------------------------------------------
-- UTF-8 Strings.
-- This single file is completly free. Please use/modify without credits. Ooz
------------------------------------------------------------------------------

-- UTF 8 Stings. Names based on HTML Entities
UTF8_iexcl = string.char(194) .. string.char(161);  -- �	
UTF8_cent = string.char(194) .. string.char(162);   -- �	
UTF8_pound = string.char(194) .. string.char(163);  -- �	
UTF8_curren = string.char(194) .. string.char(164); -- �	
UTF8_yen = string.char(194) .. string.char(165);    -- �	
UTF8_brvbar = string.char(194) .. string.char(166); -- �	
UTF8_sect = string.char(194) .. string.char(167);   -- �	
UTF8_uml = string.char(194) .. string.char(168);    -- �	
UTF8_copy = string.char(194) .. string.char(169);   -- �	
UTF8_ordf = string.char(194) .. string.char(170);   -- �	
UTF8_laquo = string.char(194) .. string.char(171);  -- �	
UTF8_not = string.char(194) .. string.char(172);    -- �	
UTF8_shy = string.char(194) .. string.char(173);    -- �	
UTF8_reg = string.char(194) .. string.char(174);    -- �	
UTF8_macr = string.char(194) .. string.char(175);   -- �	
UTF8_deg = string.char(194) .. string.char(176);    -- �	
UTF8_plusmn = string.char(194) .. string.char(177); -- �	
UTF8_sup2 = string.char(194) .. string.char(178);   -- �	
UTF8_sup3 = string.char(194) .. string.char(179);   -- �	
UTF8_acute = string.char(194) .. string.char(180);  -- �	
UTF8_micro = string.char(194) .. string.char(181);  -- �	
UTF8_para = string.char(194) .. string.char(182);   -- �	
UTF8_middot = string.char(194) .. string.char(183); -- �	
UTF8_cedil = string.char(194) .. string.char(184);  -- �	
UTF8_sup1 = string.char(194) .. string.char(185);   -- �	
UTF8_ordm = string.char(194) .. string.char(186);   -- �	
UTF8_raquo = string.char(194) .. string.char(187);  -- �	
UTF8_frac14 = string.char(194) .. string.char(188); -- �	
UTF8_frac12 = string.char(194) .. string.char(189); -- �	
UTF8_frac34 = string.char(194) .. string.char(190); -- �	
UTF8_iquest = string.char(194) .. string.char(191); -- �	

UTF8_Agrave = string.char(195) .. string.char(128); -- �	
UTF8_Aacute = string.char(195) .. string.char(129); -- �	
UTF8_Acirc = string.char(195) .. string.char(130);  -- �	
UTF8_Atilde = string.char(195) .. string.char(131); -- �	
UTF8_Auml = string.char(195) .. string.char(132);   -- �	
UTF8_Aring = string.char(195) .. string.char(133);  -- �	
UTF8_AElig = string.char(195) .. string.char(134);  -- �	
UTF8_Ccedil = string.char(195) .. string.char(135); -- �	
UTF8_Egrave = string.char(195) .. string.char(136); -- �	
UTF8_Eacute = string.char(195) .. string.char(137); -- �	
UTF8_Ecirc = string.char(195) .. string.char(138);  -- �	
UTF8_Euml = string.char(195) .. string.char(139);   -- �	
UTF8_Igrave = string.char(195) .. string.char(140); -- �	
UTF8_Iacute = string.char(195) .. string.char(141); -- �	
UTF8_Icirc = string.char(195) .. string.char(142);  -- �	
UTF8_Iuml = string.char(195) .. string.char(143);   -- �	
UTF8_ETH = string.char(195) .. string.char(144);    -- �	
UTF8_Ntilde = string.char(195) .. string.char(145); -- �	
UTF8_Ograve = string.char(195) .. string.char(146); -- �	
UTF8_Oacute = string.char(195) .. string.char(147); -- �	
UTF8_Ocirc = string.char(195) .. string.char(148);  -- �	
UTF8_Otilde = string.char(195) .. string.char(149); -- �	
UTF8_Ouml = string.char(195) .. string.char(150);   -- �	
UTF8_times = string.char(195) .. string.char(151);  -- �	
UTF8_Oslash = string.char(195) .. string.char(152); -- �	
UTF8_Ugrave = string.char(195) .. string.char(153); -- �	
UTF8_Uacute = string.char(195) .. string.char(154); -- �	
UTF8_Ucirc = string.char(195) .. string.char(155);  -- �	
UTF8_Uuml = string.char(195) .. string.char(156);   -- �	
UTF8_Yacute = string.char(195) .. string.char(157); -- �	
UTF8_THORN = string.char(195) .. string.char(158);  -- �	
UTF8_szlig = string.char(195) .. string.char(159);  -- �	
UTF8_agrave = string.char(195) .. string.char(160); -- �	
UTF8_aacute = string.char(195) .. string.char(161); -- �	
UTF8_acirc = string.char(195) .. string.char(162);  -- �	
UTF8_atilde = string.char(195) .. string.char(163); -- �	
UTF8_auml = string.char(195) .. string.char(164);   -- �	
UTF8_aring = string.char(195) .. string.char(165);  -- �	
UTF8_aelig = string.char(195) .. string.char(166);  -- �	
UTF8_ccedil = string.char(195) .. string.char(167); -- �	
UTF8_egrave = string.char(195) .. string.char(168); -- �	
UTF8_eacute = string.char(195) .. string.char(169); -- �	
UTF8_ecirc = string.char(195) .. string.char(170);  -- �	
UTF8_euml = string.char(195) .. string.char(171);   -- �	
UTF8_igrave = string.char(195) .. string.char(172); -- �	
UTF8_iacute = string.char(195) .. string.char(173); -- �	
UTF8_icirc = string.char(195) .. string.char(174);  -- �	
UTF8_iuml = string.char(195) .. string.char(175);   -- �	
UTF8_eth = string.char(195) .. string.char(176);    -- �	
UTF8_ntilde = string.char(195) .. string.char(177); -- �	
UTF8_ograve = string.char(195) .. string.char(178); -- �	
UTF8_oacute = string.char(195) .. string.char(179); -- �	
UTF8_ocirc = string.char(195) .. string.char(180);  -- �	
UTF8_otilde = string.char(195) .. string.char(181); -- �	
UTF8_ouml = string.char(195) .. string.char(182);   -- �	
UTF8_divide = string.char(195) .. string.char(183); -- �	
UTF8_oslash = string.char(195) .. string.char(184); -- �	
UTF8_ugrave = string.char(195) .. string.char(185); -- �	
UTF8_uacute = string.char(195) .. string.char(186); -- �	
UTF8_ucirc = string.char(195) .. string.char(187);  -- �	
UTF8_uuml = string.char(195) .. string.char(188);   -- �	
UTF8_yacute = string.char(195) .. string.char(189); -- �	
UTF8_thorn = string.char(195) .. string.char(190);  -- �	
UTF8_yuml = string.char(195) .. string.char(191);   -- �	

UTF8_oelig = string.char(197) .. string.char(0x92); -- �	146
UTF8_OElig = string.char(197) .. string.char(0x93); -- �	147

-- encoded character to UTF-8
UTF8_encodingMap = {
    { "�", UTF8_iexcl }
    , { "�", UTF8_cent }
, { "�", UTF8_pound }
, { "�", UTF8_curren }
, { "�", UTF8_yen }
, { "�", UTF8_brvbar }
, { "�", UTF8_sect }
, { "�", UTF8_uml }
, { "�", UTF8_copy }
, { "�", UTF8_ordf }
, { "�", UTF8_laquo }
, { "�", UTF8_not }
, { "�", UTF8_shy }
, { "�", UTF8_reg }
, { "�", UTF8_macr }
, { "�", UTF8_deg }
, { "�", UTF8_plusmn }
, { "�", UTF8_sup2 }
, { "�", UTF8_sup3 }
, { "�", UTF8_acute }
, { "�", UTF8_micro }
, { "�", UTF8_para }
, { "�", UTF8_middot }
, { "�", UTF8_cedil }
, { "�", UTF8_sup1 }
, { "�", UTF8_ordm }
, { "�", UTF8_raquo }
, { "�", UTF8_frac14 }
, { "�", UTF8_frac12 }
, { "�", UTF8_frac34 }
, { "�", UTF8_iquest }
, { "�", UTF8_Agrave, "A" }
, { "�", UTF8_Aacute, "A" }
, { "�", UTF8_Acirc, "A" }
, { "�", UTF8_Atilde, "A" }
, { "�", UTF8_Auml, "A" }
, { "�", UTF8_Aring, "A" }
, { "�", UTF8_AElig, "AE" }
, { "�", UTF8_Ccedil, "C" }
, { "�", UTF8_Egrave, "E" }
, { "�", UTF8_Eacute, "E" }
, { "�", UTF8_Ecirc, "E" }
, { "�", UTF8_Euml, "E" }
, { "�", UTF8_Igrave, "I" }
, { "�", UTF8_Iacute, "I" }
, { "�", UTF8_Icirc, "I" }
, { "�", UTF8_Iuml, "I" }
, { "�", UTF8_ETH, "�" }
, { "�", UTF8_Ntilde, "N" }
, { "�", UTF8_Ograve, "O" }
, { "�", UTF8_Oacute, "O" }
, { "�", UTF8_Ocirc, "O" }
, { "�", UTF8_Otilde, "O" }
, { "�", UTF8_Ouml, "O" }
, { "�", UTF8_times, "x" }
, { "�", UTF8_Oslash, "0" }
, { "�", UTF8_Ugrave, "U" }
, { "�", UTF8_Uacute, "U" }
, { "�", UTF8_Ucirc, "U" }
, { "�", UTF8_Uuml, "U" }
, { "�", UTF8_Yacute, "Y" }
, { "�", UTF8_THORN, "�" }
, { "�", UTF8_szlig, "�" }
, { "�", UTF8_agrave, "a" }
, { "�", UTF8_aacute, "a" }
, { "�", UTF8_acirc, "a" }
, { "�", UTF8_atilde, "a" }
, { "�", UTF8_auml, "a" }
, { "�", UTF8_aring, "a" }
, { "�", UTF8_aelig, "ae" }
, { "�", UTF8_ccedil, "c" }
, { "�", UTF8_egrave, "e" }
, { "�", UTF8_eacute, "e" }
, { "�", UTF8_ecirc, "e" }
, { "�", UTF8_euml, "e" }
, { "�", UTF8_igrave, "i" }
, { "�", UTF8_iacute, "i" }
, { "�", UTF8_icirc, "i" }
, { "�", UTF8_iuml, "i" }
, { "�", UTF8_eth, "�" }
, { "�", UTF8_ntilde, "n" }
, { "�", UTF8_ograve, "o" }
, { "�", UTF8_oacute, "o" }
, { "�", UTF8_ocirc, "o" }
, { "�", UTF8_otilde, "o" }
, { "�", UTF8_ouml, "o" }
, { "�", UTF8_divide, "/" }
, { "�", UTF8_oslash, "0" }
, { "�", UTF8_ugrave, "u" }
, { "�", UTF8_uacute, "u" }
, { "�", UTF8_ucirc, "u" }
, { "�", UTF8_uuml, "u" }
, { "�", UTF8_yacute, "y" }
, { "�", UTF8_thorn, "�" }
, { "�", UTF8_yuml, "y" }
-- ajout kiki :
, { "�", UTF8_oelig, "oe" }
, { "�", UTF8_OElig, "OE" }

    --,{"�",UTF8_suspens,"..."}
};

-- Calcul de la table de traduction TblUtfToRaw
_G.TblUtfToRaw = {};
for i, v in ipairs(UTF8_encodingMap) do
    if v[3] ~= nil then
        _G.TblUtfToRaw[v[2]] = v[3];
    end
end

_G.ToUTF8 = function(encodedString)
    local utf8result = "";
    for c in string.gmatch(encodedString, ".") do
        local isUnmapped = true;
        for i, v in ipairs(UTF8_encodingMap) do
            if c == v[1] then
                utf8result = utf8result .. v[2];
                isUnmapped = false;
                break;
            end
        end
        if isUnmapped then
            utf8result = utf8result .. c;
        end
    end
    return utf8result;
end

_G.FromUTF8 = function(utf8String)
    local encodedresult = "";
    local sequence = false;
    local sequencePrefix = "";
    for c in string.gmatch(utf8String, ".") do
        b = string.byte(c);
        if sequence then
            for i, v in ipairs(UTF8_encodingMap) do
                if sequencePrefix .. c == v[2] then
                    encodedresult = encodedresult .. v[1];
                    break;
                end
            end
            sequence = false;
            sequencePrefix = "";
        elseif b == 194 or b == 195 then
            sequence = true;
            sequencePrefix = c;
        else
            encodedresult = encodedresult .. c;
        end
    end
    return encodedresult;
end

_G.FromUTF82 = function(utf8String)
    local encodedresult = "";
    for i = 1, table.getn(utf8String), 1 do
        b = string.byte(i);
        if (UTF8_encodingMap[b] == nil) then
            encodedresult = encodedresult .. b;
        else
            encodedresult = encodedresult .. UTF8_encodingMap[b][2];
        end
    end
    return encodedresult;
end

-- Retourne la chaine lowerUtf du parametre
_G.UtfToRawLower = function(str)
    return (str == nil and "") or str:gsub("([\195-\197].)", _G.TblUtfToRaw):lower();
end
